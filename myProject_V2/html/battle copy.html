<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/battle.css">
    <link rel="stylesheet" href="../css/loading.css">
    <link rel="stylesheet" href="../css/animate.css">

    <style>
        #topInfo {

            position: absolute;
            top: 10px;
            background-color: rgba(38, 12, 12, 0.5);
            color: tomato;
            display: none;

        }

        #battleInfo {
            background-color: rgba(38, 12, 12, 0.5);
            color: white;
        }
    </style>
</head>

<body>
    <main id="mainArea">
        <div id="topArea">
            <div>
                <audio controls autoplay="" >
                    <source src="../audio/battle.mp3" type="audio/mp3">
                </audio>
            </div>

            <div>

            </div>

        </div>
        <div id="midArea">
            <div id="midAreaLeft">
                <!-- <img id="leftImg" src="../image/monster01V1.png" alt=""> -->
            </div>
            <div id="midAreaMid">
                <p id="topInfo">請選擇攻擊對象 : </p>
                <img id="centerImg" class="" style="display:block ;animation-duration:2.2s" src="../image/BOSSV1.png" alt="">
                <img id='hitEffect01' style="display:block" src="" alt="">
            </div>

            <div id="midAreaRight">
                <!-- <img id="rightImg" src="../image/BOSS02V1.jpg.png" alt=""> -->
            </div>
        </div>
        <div id="bottomArea">
            <div id="battleList">
                <div><button id="normalFight" onclick="hitBtn()">攻擊</button></div>
                <div>
                    <button>物品</button>
                    <button onclick="utlBtn()">絕學</button>
                </div>
                <div><button>逃跑</button></div>

            </div>
            <div id="roleList">

                <div id="anotherRoleplay01">
                    <img src="../image/anotherrole01V2.png" alt="">

                </div>
                <div id="anotherRoleplay02">
                    <img src="../image/anotherrole02V1.png" alt="">
                </div>
            </div>
            <div id="battleInfo">
                <p id="demo1"></p>
                <p id="demo2"></p>

            </div>



        </div>

    </main>
    <script>
        //設定BOSS屬性
        let bossObjCenter = {
            'id': 'imgCenter',
            'src': 'https://dummyimage.com/200X200/ba5fba/7076d6',
            'hp': 3000,
            'damage': Math.floor(Math.random() * 100)
        }
        //設定男主屬性
        let manPlayerObj = {
            'hp': 999,
            'damage': Math.floor(Math.random() * 1000)
        }
        // 計算次數
        let checkNum = 1;
        setTimeout(myRound, 2000);
        function myRound() {
            let demoInfo = document.getElementById('demo1');
            demoInfo.innerText = `第${checkNum}回合`
            checkNum += 1;
        }
        // 因為特效結束後會有殘影留在圖上，所以要再把特效圖片清空
        function clearEffect() {
            document.getElementById('hitEffect01').setAttribute('src', '');
        }


        function hitBtn() {
            //取得按鈕元素
            let btnDisplay = document.getElementById('normalFight');
            //取得上方資訊列
            let topInfoDisplay = document.getElementById('topInfo');
            //點擊按鈕的時候改變按鈕文字
            chengeWords();
            showTopInfo();
            //一次攻擊流程
            attack();
            bossDie()

        }
        function utlBtn() {
            //取得按鈕元素
            let btnDisplay = document.getElementById('normalFight');
            //取得上方資訊列
            let topInfoDisplay = document.getElementById('topInfo');
            //點擊按鈕的時候改變按鈕文字
            chengeWords();
            showTopInfo();
            //一次攻擊流程
            attackUtl();
            bossDie();

        }

        //顯示上方對話框
        function showTopInfo() {
            let topInfoDisplay = document.getElementById('topInfo')
            let btnDisplay = document.getElementById('normalFight');
            let myBossId = document.getElementById('centerImg');
            //當涵式被呼叫時會顯示上方對話框
            topInfoDisplay.style.display = 'block';
            //點選物件之後對話框消失
            myBossId.addEventListener('click', function () {
                topInfoDisplay.style.display = 'none';
            }, { once: true })

        }

        //改變按鈕文字
        function chengeWords() {
            let btnDisplay = document.getElementById('normalFight');
            //當按鈕點擊時會改變文字顯示
            if (btnDisplay.innerText != '攻擊') {
                btnDisplay.innerText = '攻擊'

            } else {
                btnDisplay.innerText = '取消'

            }
        }

        function attack() {
            let btnDisplay = document.getElementById('normalFight');
            let topInfoDisplay = document.getElementById('topInfo')
            //取得BOSS物件ID
            let myBossId = document.getElementById('centerImg');
            //取得HP 顯示區域ID
            let myid2 = document.getElementById('demo2');
            //取得特效區域
            let getBurst = document.getElementById('hitEffect01')
            //在螢幕上點擊物件觸發事件監聽，呼叫三個函式 增加效果(自己新增)、效果消失(attackDisable)、生命減少(damageBOSS) 
            myBossId.addEventListener('click', function () {
                console.log('BOSS被點擊囉');
                getBurst.setAttribute('src', '../image/hit_03V3.gif')
            }, { once: true });
            setTimeout(clearEffect, 2000);
            setTimeout(damageBOSS, 2000);
            setTimeout(myRound, 2000);
            setTimeout(chengeWords, 2400);          

        }
        function attackUtl() { 
            let btnDisplay = document.getElementById('normalFight');
            let topInfoDisplay = document.getElementById('topInfo')
            //取得BOSS物件ID
            let myBossId = document.getElementById('centerImg');
            //取得HP 顯示區域ID
            let myid2 = document.getElementById('demo2');
            //取得特效區域
            let getBurst = document.getElementById('hitEffect01')
            let showValid = function () {
                getBurst.setAttribute('src', '../image/hit_01V3.gif')
            }
            //在螢幕上點擊物件觸發事件監聽，呼叫三個函式 增加效果(自己新增)、效果消失(attackDisable)、生命減少(damageBOSS) 
            myBossId.addEventListener('click', function () {
                console.log('BOSS被點擊囉');
                getBurst.setAttribute('src', '../image/attackV2.gif')
                setTimeout(showValid,7300)
            }, { once: true });
            setTimeout(clearEffect, 8800);
            setTimeout(bigDamage, 8800);
            setTimeout(myRound, 2000);
            setTimeout(chengeWords, 2000);          

        }
        

        //減HP函數
        function damageBOSS() {
            let mydamage = Math.floor(Math.random() * 1000);
            let bossHp = bossObjCenter.hp;
            let mydemo1 = document.getElementById('demo2');
            bossObjCenter.hp = bossHp - mydamage;
            if (bossObjCenter.hp <= 0) {
                bossObjCenter.hp = 0;
                mydemo1.innerText = `當前HP : ${bossObjCenter.hp}，BOSS死亡`
                bossDie()
            } else {
                mydemo1.innerText = `對BOSS造成傷害${mydamage}`;
            }

            console.log(`對BOSS造成傷害${mydamage}，BOSS剩餘HP : ${mydemo1.innerText}`)
        }
        //放大招
        function bigDamage() { 
            mydamage = Math.floor(Math.random() * 100000);
            let bossHp = bossObjCenter.hp;
            let mydemo1 = document.getElementById('demo2');
            bossObjCenter.hp = bossHp - mydamage;
            if (bossObjCenter.hp <= 0) {
                bossObjCenter.hp = 0;
                mydemo1.innerText = `當前HP : ${bossObjCenter.hp}，BOSS死亡`
                bossDie()
            } else {
                mydemo1.innerText = `對BOSS造成傷害${mydamage}`;
            }

            console.log(`對BOSS造成傷害${mydamage}，BOSS剩餘HP : ${mydemo1.innerText}`)
         }

        //當hp = 0時，添加動畫
        function bossDie() {
            let bossImg = document.getElementById('centerImg');
            let bosshp = bossObjCenter.hp;
            //先取得class屬性
            let classVal = bossImg.getAttribute("class");
            //設定一個函數當hp歸零時圖會消失
            let bosshidden = function(){
                bossImg.setAttribute('src','')
            }
            //連接各class屬性
            classVal = classVal.concat('animated ')
            classVal = classVal.concat('ld ')
            classVal = classVal.concat('ld-fade')
            // 當hp歸零時，使用動畫
            if (bossObjCenter.hp <= 0) {
                //先出現動畫，2秒後圖消失
                bossImg.setAttribute('class', classVal);
                setTimeout(bosshidden,2000)
            }

        }
  

    </script>
</body>

</html>